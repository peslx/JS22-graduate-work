(()=>{"use strict";(new class{constructor(){this.forms=document.querySelectorAll("form"),this.validate={words:{cyr:e=>e.replace(/[^а-яА-Я\- ]/g,""),lat:e=>e.replace(/[^a-zA-Z\- ]/g,""),any:e=>e.replace(/[^а-яА-Яa-zA-Z\- ]/g,"")},digits:e=>e.replace(/\D/g,""),mail:e=>e.replace(/[^a-zA-Z0-9\-@_.~!'*]/g,""),phone:e=>e.replace(/[^\d\(\)\+\-]/g,""),onInput:e=>{"text"==e.type?"phone"==e.name?e.value=this.validate.phone(e.value):"email"==e.name?e.value=this.validate.mail(e.value):(e.value=e.value.replace(/^\s+/,""),e.value=this.validate.words.any(e.value)):"email"==e.type?e.value=this.validate.mail(e.value):"tel"==e.type&&(e.value=this.validate.phone(e.value))},onBlur:e=>{e.value=e.value.trim(),e.value=e.value.replace(/\s+\b/g," "),e.value=e.value.replace(/\b\s+/g," "),e.value=e.value.replace(/\s+/g," "),e.value=e.value.replace(/\-+/g,"-"),e.value=e.value.replace(/(^-)|(-$)/g,""),e.value=e.value.replace(/(^ +)|( +$)/g,""),"text"===e.type&&""!==e.value&&(e.value=e.value.split(/\s/).map((e=>e[0].toUpperCase()+e.substring(1))).join(" "))}}}setValid(e){e.classList.remove("validError"),e.classList.add("validOk"),e.style.borderBottom="2px solid green",e.style.color="green",e.style.backgroundColor="#88ff88"}setInvalid(e){e.classList.remove("validOk"),e.classList.add("validError"),e.style.borderBottom="2px solid red",e.style.color="red",e.style.backgroundColor="#ff8888"}addInvalidListener(e,l=!1){e.addEventListener("invalid",(a=>{a.preventDefault(),setInvalid(e),l&&console.error(`${e.name}: 'пустое значение'`)}))}checkValidity(e,l=!1){""!==e.value?this.setValid(e):(this.setInvalid(e),l&&console.error(`${e.name}: 'пустое значение'`))}removeValidClass(e){e.classList.remove("validOk"),e.classList.remove("validError"),e.style.borderBottom="",e.style.color="",e.style.backgroundColor="","hidden"!==e.type&&(e.value="")}sendForm(e,l="https://jsonplaceholder.typicode.com/posts"){return fetch(l,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>e.json()))}onSubmit(e,l,a=!1){if(l){let l={};e.querySelectorAll("input").forEach((e=>{l[e.name]=e.value,this.removeValidClass(e)})),this.sendForm(l).then((e=>a?console.log("Ответ от сервера: "+JSON.stringify(e)):null))}else a&&console.error(`Ошибка в форме (${e.id?"id:"+e.id:"name:"+e.name}): "Форма не заполнена"`)}init(e=!1){e&&console.log(this),this.forms.forEach((l=>{l.querySelectorAll("input").forEach((l=>{l.addEventListener("input",(()=>{this.validate.onInput(l)})),l.addEventListener("blur",(e=>{this.validate.onBlur(l)})),this.addInvalidListener(l,e)}))})),document.addEventListener("submit",(l=>{this.forms.forEach((a=>{if(l.target===a){l.preventDefault();let t=!0;a.querySelectorAll("input").forEach((l=>{this.checkValidity(l,e),l.addEventListener("change",(()=>{this.checkValidity(l)})),l.classList.contains("validError")&&(t=!1)})),this.onSubmit(a,t,e)}}))}))}}).init()})();